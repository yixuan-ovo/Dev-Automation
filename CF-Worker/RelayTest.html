<!DOCTYPE html>
<html lang="zh">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>CF Worker Relay æµ‹è¯•é¢æ¿</title>
<style>
body {
  font-family: "Segoe UI", sans-serif;
  background: #f6f8fa;
  color: #222;
  padding: 20px;
  line-height: 1.6;
}
input, button {
  padding: 8px 12px;
  font-size: 14px;
  border-radius: 6px;
  border: 1px solid #ccc;
  margin-right: 8px;
}
button {
  cursor: pointer;
  background: #0078ff;
  color: #fff;
  border: none;
}
button:hover {
  background: #005ecc;
}
#result {
  margin-top: 20px;
  background: #fff;
  padding: 16px;
  border-radius: 8px;
  box-shadow: 0 2px 4px rgba(0,0,0,0.1);
  white-space: pre-wrap;
  word-break: break-all;
}
</style>
</head>
<body>
  <h1>ğŸ” CF Worker Relay è‡ªæµ‹é¢æ¿</h1>
  <p>æµ‹è¯•ä½ çš„ä¸» Workerï¼ˆ<code>sub.yixr.uno</code>ï¼‰å’Œä¸­ç»§ Workerï¼ˆ<code>relay.yixr.uno</code>ï¼‰æ˜¯å¦ååŒå·¥ä½œã€‚</p>

  <label>æµ‹è¯•è®¢é˜…æºï¼š</label>
  <input id="testUrl" style="width:400px" value="http://93.184.216.34" />
  <button onclick="testWorker()">æµ‹è¯•ä¸» Worker</button>
  <button onclick="testRelay()">æµ‹è¯• Relay ç›´è¿</button>

  <div id="result">ç»“æœå°†åœ¨è¿™é‡Œæ˜¾ç¤º...</div>

<script>
async function testWorker() {
  const target = document.getElementById("testUrl").value.trim();
  const testLink = `https://sub.yixr.uno/?url=${encodeURIComponent(target)}`;
  const resultDiv = document.getElementById("result");
  resultDiv.textContent = `â³ æ­£åœ¨è¯·æ±‚ï¼š${testLink}\n\n`;

  const t0 = performance.now();
  try {
    const res = await fetch(testLink);
    const t1 = performance.now();
    const text = await res.text();
    const preview = text.slice(0, 400);
    const ctype = res.headers.get('content-type') || '(æ— )';

    resultDiv.textContent += `${res.ok ? 'âœ…' : 'âš ï¸'} çŠ¶æ€ç ï¼š${res.status}\n`;
    resultDiv.textContent += `â±ï¸ è€—æ—¶ï¼š${(t1 - t0).toFixed(1)} ms\n`;
    resultDiv.textContent += `ğŸ“¦ Content-Typeï¼š${ctype}\n`;
    resultDiv.textContent += `ğŸ“„ å†…å®¹å‰ 400 å­—ç¬¦ï¼š\n${preview}\n\n`;

    // ä¸ Worker ä¾§ä¸€è‡´çš„ IP/æœ¬åœ°åˆ¤å®š
    try {
      const u = new URL(target);
      const host = u.hostname;
      const isIPv4 = /^\d{1,3}(\.\d{1,3}){3}$/.test(host);
      const isLocalhost = host === 'localhost' || host === '::1';
      const isIPv6 = host.includes(':');
      const isIPv6Local = isIPv6 && (/^(::1)$/i.test(host) || /^(fc|fd|fe80)/i.test(host));
      const isLocalSuffix = /\.(local|localhost|internal)$/i.test(host);
      const isIpOrLocal = isIPv4 || isIPv6Local || isLocalhost || isLocalSuffix;
      if (isIpOrLocal) {
        resultDiv.textContent += `ğŸ’¡ æ£€æµ‹åˆ° IP/æœ¬åœ°æºï¼Œä¸» Worker åº”å·²è‡ªåŠ¨é€šè¿‡ relay.yixr.uno ä¸­è½¬ã€‚\n`;
      } else {
        resultDiv.textContent += `ğŸŒ è¿™æ˜¯åŸŸåæºï¼Œä¸» Worker ç›´æ¥è®¿é—®ã€‚\n`;
      }
    } catch (_) {}
  } catch (err) {
    resultDiv.textContent += `âŒ é”™è¯¯ï¼š${err.message}`;
  }
}

async function testRelay() {
  const target = document.getElementById("testUrl").value.trim();
  const relayLink = `https://relay.yixr.uno/?target=${encodeURIComponent(target)}`;
  const resultDiv = document.getElementById("result");
  resultDiv.textContent = `â³ æ­£åœ¨è¯·æ±‚ï¼ˆRelayï¼‰ï¼š${relayLink}\n\n`;

  const t0 = performance.now();
  try {
    const res = await fetch(relayLink);
    const t1 = performance.now();
    const text = await res.text();
    const preview = text.slice(0, 400);
    const ctype = res.headers.get('content-type') || '(æ— )';

    resultDiv.textContent += `${res.ok ? 'âœ…' : 'âš ï¸'} çŠ¶æ€ç ï¼š${res.status}\n`;
    resultDiv.textContent += `â±ï¸ è€—æ—¶ï¼š${(t1 - t0).toFixed(1)} ms\n`;
    resultDiv.textContent += `ğŸ“¦ Content-Typeï¼š${ctype}\n`;
    resultDiv.textContent += `ğŸ“„ å†…å®¹å‰ 400 å­—ç¬¦ï¼š\n${preview}\n\n`;
  } catch (err) {
    resultDiv.textContent += `âŒ é”™è¯¯ï¼š${err.message}`;
  }
}
</script>
</body>
</html>
